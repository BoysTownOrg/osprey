{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Osprey \u00b6 Osprey is an all-in-one software suite for state-of-the art processing and quantitative analysis of in-vivo magnetic resonance spectroscopy (MRS) data. Contact, Feedback, Suggestions \u00b6 For any sort of questions, feedback, suggestions, or critique, please visit the Osprey support forum on the MRSHub . We also welcome your direct contributions to Osprey in the Osprey GitHub repository . Developers \u00b6 Georg Oeltzschner Helge J. Z\u00f6llner Richard A. E. Edden Should you publish material that made use of Osprey, please cite the following publication: G Oeltzschner, HJ Z\u00f6llner, SCN Hui, M Mikkelsen, MG Saleh, S Tapper, RAE Edden. Osprey: Open-Source Processing, Reconstruction & Estimation of Magnetic Resonance Spectroscopy Data. bioRxiv 2020. Acknowledgements \u00b6 We wish to thank the following individuals for their contributions to the development of Osprey and shared processing code: Jamie Near (McGill University, Montreal) Ralph Noeske (GE Healthcare, Berlin) Peter Barker (Johns Hopkins University, Baltimore) Robin de Graaf (Yale School of Medicine, New Haven) Philipp Ehses (German Center for Neurodegenerative Diseases, Bonn) Wouter Potters (UMC Amsterdam) This work has been supported by NIH grants R01EB016089, P41EB15909, R01EB023963, and K99AG062230.","title":"Home"},{"location":"#osprey","text":"Osprey is an all-in-one software suite for state-of-the art processing and quantitative analysis of in-vivo magnetic resonance spectroscopy (MRS) data.","title":"Osprey"},{"location":"#contact-feedback-suggestions","text":"For any sort of questions, feedback, suggestions, or critique, please visit the Osprey support forum on the MRSHub . We also welcome your direct contributions to Osprey in the Osprey GitHub repository .","title":"Contact, Feedback, Suggestions"},{"location":"#developers","text":"Georg Oeltzschner Helge J. Z\u00f6llner Richard A. E. Edden Should you publish material that made use of Osprey, please cite the following publication: G Oeltzschner, HJ Z\u00f6llner, SCN Hui, M Mikkelsen, MG Saleh, S Tapper, RAE Edden. Osprey: Open-Source Processing, Reconstruction & Estimation of Magnetic Resonance Spectroscopy Data. bioRxiv 2020.","title":"Developers"},{"location":"#acknowledgements","text":"We wish to thank the following individuals for their contributions to the development of Osprey and shared processing code: Jamie Near (McGill University, Montreal) Ralph Noeske (GE Healthcare, Berlin) Peter Barker (Johns Hopkins University, Baltimore) Robin de Graaf (Yale School of Medicine, New Haven) Philipp Ehses (German Center for Neurodegenerative Diseases, Bonn) Wouter Potters (UMC Amsterdam) This work has been supported by NIH grants R01EB016089, P41EB15909, R01EB023963, and K99AG062230.","title":"Acknowledgements"},{"location":"03%20-%20Quick%20Start%20Guide/","text":"Quick Start Guide \u00b6 This chapter is intended to serve as a quick rundown of the Osprey workflow, as well as syntax cheat sheet for more experienced users. The full documentation for each of the following commands can be found in their respective sections. Please familiarize yourself with the basic Osprey commands. The number of commands is deliberately kept to a minimum to facilitate a largely automated workflow with as little user interaction as necessary. OspreyJob \u00b6 At the beginning of every analysis, you initialize a fresh MRSCont data container with a job (defined in the file jobFile ) using the following command: [MRSCont] = OspreyJob(jobFile); OspreyJob will add all necessary information required for data analysis to the data container, and perform a few basic sanity checks. A valid Osprey job file contains: - a list of MRS (and, optionally, structural imaging) data files to be loaded - basic information on the MRS sequence used - settings for data modeling - an output folder to store the results and exported files - an external csv file with statistical information (e.g. group allocations, age,...) Osprey job files are described in .m format. Please refer to the OspreyJob chapter for detailed instructions on how to create a job. A good way to understand the structure of a job file is to study the example jobs in the Osprey/exampledata directory, and to create your own job starting from there. Before you create your own job, consider the recommendations on how to organize your data in the previous chapter. OspreyLoad \u00b6 After loading a job file, you can start the data loading by invoking the function [MRSCont] = OspreyLoad(MRSCont); OspreyLoad will automatically determine the file format, load the raw data, and, if multi-array receiver coils have been used for acquisition, perform the receiver-channel combination. Please refer to the OspreyLoad chapter for details on the supported file formats and the coil combination techniques. OspreyProcess \u00b6 OspreyLoad only loads the raw data and organizes them in a uniform way, in order to streamline further processing. The next command is a cornerstone of the entire Osprey pipeline, as it will initiate a series of automatic processing steps: [MRSCont] = OspreyProcess(MRSCont); OspreyProcess performs all state-of-the-art MRS post-processing techniques to ensure optimal spectral quality, including eddy-current correction, frequency-and-phase correction, removal of residual water, baseline correction, and automated phasing and frequency referencing. In addition, several basic quality metrics (linewidth, SNR) are determined. OspreyProcess is also responsible for handling all aspects of data processing that are specific to J -difference-edited (\"spectral editing\") experiments, such as MEGA, HERMES, and HERCULES. These additional steps include alignment of sub-spectra to reduce subtraction artefacts, as well as the calculation of (Hadamard-encoded) difference spectra. Finally, OspreyProcess can write the processed spectra into files formats that are readable by spectral fitting software packages like LCModel, TARQUIN, or jMRUI: - To write LCModel-readable .RAW files, you need to set a switch opts.saveLCM = 1 in your job file. You can then load the .RAW file via the Other option in the LCModel file type selection menu. - To write jMRUI/TARQUIN-readable .TXT files, you need to set a switch opts.saveJMRUI = 1 in your job file. - Please be aware that LCModel may prompt you to enter the number of FID data points (a positive integer number, e.g. 2048), dwell time (in seconds, e.g. 0.0005), and the static magnetic field strength in Hz (eg 123.26 for a Siemens 2.89 T magnet). In TARQUIN, you will probably need to enter the echo time in seconds (e.g. 0.03 for a 30-ms acquisition). You can extract this information from the Osprey MRSCont data container, or ... - ... by setting the switch opts.saveVendor = 1 in your job file, Osprey will create single vendor-specific files, i.e. .SDAT/.SPAR files for Philips data, and .RDA files for Siemens data, regardless of the raw data format. This function has been introduced to sidestep the above-mentioned problems with .RAW and .TXT files. LCModel, TARQUIN and jMRUI accept the .SDAT/.SPAR and .RDA file formats, and should be able to read the header information correctly. All exported third-party format files are stored in sub-directories of the output folder specified in the job file. Please refer to the OspreyProcess chapter for details on the implementation of the various post-processing steps. OspreyCoreg \u00b6 You can provide a T1-weighted structural image in NIfTI format ( *.nii ) in order to perform voxel co-registration and segmentation. The function OspreyCoreg will extract voxel geometry information from the MRS data headers, and leverage SPM12 NIfTI handling functions to create an SPM image volume containing a voxel mask. The voxel masks will be saved in a sub-directory ( /VoxelMasks/ ) of the output folder specified in the job file. The path to the structural image is provided in the job definition. After running OspreyLoad , you can call the co-registration routine using the command [MRSCont] = OspreyCoreg(MRSCont); Please refer to the OspreyCoreg chapter for details. OspreySeg \u00b6 OspreySeg calls the SPM12 tissue segmentation algorithm (\"New Segment\") to segment the T1-weighted structural image into grey matter (GM), white matter (WM), and cerebro-spinal fluid (CSF). The relative volume fractions for each tissue class is subsequently used to perform water-scaled concentration estimation, including CSF correction and tissue-specific relaxation correction. OspreySeg requires that OspreyLoad and OspreyCoreg have been run before. It can be called with the command [MRSCont] = OspreySeg(MRSCont); Please refer to the OspreySeg chapter for details. OspreyFit \u00b6 OspreyFit performs linear-combination modeling of the processed spectra. The Osprey fitting algorithm is using metabolite basis functions for the specific MRS sequence, which are calculated from 2-D spatially resolved full density-matrix simulations, using the real sequence timings and pulse waveforms wherever possible. The linear-combination modeling performed by OspreyFit is similar to the fitting carried out by the algorithms in LCModel, TARQUIN, or QUEST/AQSES in jMRUI. In all brevity, the algorithm performs a non-linear least-squares optimization (Levenberg-Marquardt) of several amplitude, phase, lineshape, and baseline parameters in order to minimize the difference between the modeled spectra and the data. OspreyFit will save all relevant modeling parameters into the MRSCont data container. These values will be subsequently used in OspreyQuantify to produce quantitative estimates for all metabolites specified in the basis set. OspreyFit requires that OspreyLoad and OspreyProcess have been run before. It can be called with the command [MRSCont] = OspreyFit(MRSCont); Please refer to the OspreyFit chapter for details on the algorithmic implementation, basis set creation, and available modeling settings. OspreyQuantify \u00b6 OspreyQuantify calculates various quantitative results from the modeling parameters that were previously estimated by OspreyFit . Depending on the data that you have provided in the job file (and on the type of sequence that has been run), not all of the following quantitative results may be available: Metabolite ratios with respect to total creatine. Since the internal creatine standard is present in all spectra, this result is always calculated. Raw water-scaled metabolite ratios. This is the pure, uncorrected ratio of the metabolite amplitude to the amplitude of an unsuppressed water signal. If a short-TE water reference spectrum has been provided (in the files_w field in the job file), its amplitude will be used as the denominator instead of the water reference signal ( files_ref in the job file). CSF-corrected water-scaled ratios. This is the raw water-scaled metabolite ratio corrected by the fractional volume of CSF in the value ( 1/f_{CSF} 1/f_{CSF} ). Tissue- and relaxation-corrected water-scaled ratios. These values are fully corrected for tissue-fraction and relaxation effects according to Gasparovic et al, Magn Reson Med 55:1219-1226 (2016). OspreyQuantify requires that at least OspreyLoad , OspreyProcess and OspreyFit have been run before - any metrics involving tissue fractions require OspreyCoreg and OspreySeg as well. OspreyQuantify is invoked with the command [MRSCont] = OspreyQuantify(MRSCont); Please refer to the OspreyQuantify chapter for details on the availability of each quantification technique, detailed mathematical implementations, and the default relaxation correction values. OspreyOverview \u00b6 OspreyOverview creates scaled individual spectra for all sub-spectra. Furthermore, the indivdual fits, baseline estimates, and residuals are stored. For each of the before mentioned measures the mean and the standard deviation are calculated. If different groups are passed through the external csv file the data is separated based on the corresponding groups. OspreyOverview requires that at least OspreyLoad , OspreyProcess and OspreyFit have been run before. OspreyOverview is invoked with the command [MRSCont] = OspreyOverview(MRSCont); Please refer to the OspreyOverview chapter for details on the scaling and how correlation measures are stored. OspreyGUI \u00b6 At any given point during your analysis, you can invoke the Osprey GUI to visualize the above steps. The Osprey GUI contains several tabs representing the various stages of the Osprey workflow, i.e. Load , Process , Fit , Coreg/Seg , and Quantify . It allows the export of different figures as esp files. In addition, various useful summary plots and basic statistical evaluations of the quantitative results are shown in the Overview tab. This tab gets activated only if more than one dataset has been fully analyzed. The GUI can be initialized using the command. OspreyStartUp All of the above-mentioned analysis steps can also be called from inside the GUI using the respective buttons. Please refer to the OspreyGUI chapter for details. You can also load a MRSCont from your MATLAB workspace into the GUI by using gui = OspreyGUIapp(MRSCont);","title":"03   Quick Start Guide"},{"location":"03%20-%20Quick%20Start%20Guide/#quick-start-guide","text":"This chapter is intended to serve as a quick rundown of the Osprey workflow, as well as syntax cheat sheet for more experienced users. The full documentation for each of the following commands can be found in their respective sections. Please familiarize yourself with the basic Osprey commands. The number of commands is deliberately kept to a minimum to facilitate a largely automated workflow with as little user interaction as necessary.","title":"Quick Start Guide"},{"location":"03%20-%20Quick%20Start%20Guide/#ospreyjob","text":"At the beginning of every analysis, you initialize a fresh MRSCont data container with a job (defined in the file jobFile ) using the following command: [MRSCont] = OspreyJob(jobFile); OspreyJob will add all necessary information required for data analysis to the data container, and perform a few basic sanity checks. A valid Osprey job file contains: - a list of MRS (and, optionally, structural imaging) data files to be loaded - basic information on the MRS sequence used - settings for data modeling - an output folder to store the results and exported files - an external csv file with statistical information (e.g. group allocations, age,...) Osprey job files are described in .m format. Please refer to the OspreyJob chapter for detailed instructions on how to create a job. A good way to understand the structure of a job file is to study the example jobs in the Osprey/exampledata directory, and to create your own job starting from there. Before you create your own job, consider the recommendations on how to organize your data in the previous chapter.","title":"OspreyJob"},{"location":"03%20-%20Quick%20Start%20Guide/#ospreyload","text":"After loading a job file, you can start the data loading by invoking the function [MRSCont] = OspreyLoad(MRSCont); OspreyLoad will automatically determine the file format, load the raw data, and, if multi-array receiver coils have been used for acquisition, perform the receiver-channel combination. Please refer to the OspreyLoad chapter for details on the supported file formats and the coil combination techniques.","title":"OspreyLoad"},{"location":"03%20-%20Quick%20Start%20Guide/#ospreyprocess","text":"OspreyLoad only loads the raw data and organizes them in a uniform way, in order to streamline further processing. The next command is a cornerstone of the entire Osprey pipeline, as it will initiate a series of automatic processing steps: [MRSCont] = OspreyProcess(MRSCont); OspreyProcess performs all state-of-the-art MRS post-processing techniques to ensure optimal spectral quality, including eddy-current correction, frequency-and-phase correction, removal of residual water, baseline correction, and automated phasing and frequency referencing. In addition, several basic quality metrics (linewidth, SNR) are determined. OspreyProcess is also responsible for handling all aspects of data processing that are specific to J -difference-edited (\"spectral editing\") experiments, such as MEGA, HERMES, and HERCULES. These additional steps include alignment of sub-spectra to reduce subtraction artefacts, as well as the calculation of (Hadamard-encoded) difference spectra. Finally, OspreyProcess can write the processed spectra into files formats that are readable by spectral fitting software packages like LCModel, TARQUIN, or jMRUI: - To write LCModel-readable .RAW files, you need to set a switch opts.saveLCM = 1 in your job file. You can then load the .RAW file via the Other option in the LCModel file type selection menu. - To write jMRUI/TARQUIN-readable .TXT files, you need to set a switch opts.saveJMRUI = 1 in your job file. - Please be aware that LCModel may prompt you to enter the number of FID data points (a positive integer number, e.g. 2048), dwell time (in seconds, e.g. 0.0005), and the static magnetic field strength in Hz (eg 123.26 for a Siemens 2.89 T magnet). In TARQUIN, you will probably need to enter the echo time in seconds (e.g. 0.03 for a 30-ms acquisition). You can extract this information from the Osprey MRSCont data container, or ... - ... by setting the switch opts.saveVendor = 1 in your job file, Osprey will create single vendor-specific files, i.e. .SDAT/.SPAR files for Philips data, and .RDA files for Siemens data, regardless of the raw data format. This function has been introduced to sidestep the above-mentioned problems with .RAW and .TXT files. LCModel, TARQUIN and jMRUI accept the .SDAT/.SPAR and .RDA file formats, and should be able to read the header information correctly. All exported third-party format files are stored in sub-directories of the output folder specified in the job file. Please refer to the OspreyProcess chapter for details on the implementation of the various post-processing steps.","title":"OspreyProcess"},{"location":"03%20-%20Quick%20Start%20Guide/#ospreycoreg","text":"You can provide a T1-weighted structural image in NIfTI format ( *.nii ) in order to perform voxel co-registration and segmentation. The function OspreyCoreg will extract voxel geometry information from the MRS data headers, and leverage SPM12 NIfTI handling functions to create an SPM image volume containing a voxel mask. The voxel masks will be saved in a sub-directory ( /VoxelMasks/ ) of the output folder specified in the job file. The path to the structural image is provided in the job definition. After running OspreyLoad , you can call the co-registration routine using the command [MRSCont] = OspreyCoreg(MRSCont); Please refer to the OspreyCoreg chapter for details.","title":"OspreyCoreg"},{"location":"03%20-%20Quick%20Start%20Guide/#ospreyseg","text":"OspreySeg calls the SPM12 tissue segmentation algorithm (\"New Segment\") to segment the T1-weighted structural image into grey matter (GM), white matter (WM), and cerebro-spinal fluid (CSF). The relative volume fractions for each tissue class is subsequently used to perform water-scaled concentration estimation, including CSF correction and tissue-specific relaxation correction. OspreySeg requires that OspreyLoad and OspreyCoreg have been run before. It can be called with the command [MRSCont] = OspreySeg(MRSCont); Please refer to the OspreySeg chapter for details.","title":"OspreySeg"},{"location":"03%20-%20Quick%20Start%20Guide/#ospreyfit","text":"OspreyFit performs linear-combination modeling of the processed spectra. The Osprey fitting algorithm is using metabolite basis functions for the specific MRS sequence, which are calculated from 2-D spatially resolved full density-matrix simulations, using the real sequence timings and pulse waveforms wherever possible. The linear-combination modeling performed by OspreyFit is similar to the fitting carried out by the algorithms in LCModel, TARQUIN, or QUEST/AQSES in jMRUI. In all brevity, the algorithm performs a non-linear least-squares optimization (Levenberg-Marquardt) of several amplitude, phase, lineshape, and baseline parameters in order to minimize the difference between the modeled spectra and the data. OspreyFit will save all relevant modeling parameters into the MRSCont data container. These values will be subsequently used in OspreyQuantify to produce quantitative estimates for all metabolites specified in the basis set. OspreyFit requires that OspreyLoad and OspreyProcess have been run before. It can be called with the command [MRSCont] = OspreyFit(MRSCont); Please refer to the OspreyFit chapter for details on the algorithmic implementation, basis set creation, and available modeling settings.","title":"OspreyFit"},{"location":"03%20-%20Quick%20Start%20Guide/#ospreyquantify","text":"OspreyQuantify calculates various quantitative results from the modeling parameters that were previously estimated by OspreyFit . Depending on the data that you have provided in the job file (and on the type of sequence that has been run), not all of the following quantitative results may be available: Metabolite ratios with respect to total creatine. Since the internal creatine standard is present in all spectra, this result is always calculated. Raw water-scaled metabolite ratios. This is the pure, uncorrected ratio of the metabolite amplitude to the amplitude of an unsuppressed water signal. If a short-TE water reference spectrum has been provided (in the files_w field in the job file), its amplitude will be used as the denominator instead of the water reference signal ( files_ref in the job file). CSF-corrected water-scaled ratios. This is the raw water-scaled metabolite ratio corrected by the fractional volume of CSF in the value ( 1/f_{CSF} 1/f_{CSF} ). Tissue- and relaxation-corrected water-scaled ratios. These values are fully corrected for tissue-fraction and relaxation effects according to Gasparovic et al, Magn Reson Med 55:1219-1226 (2016). OspreyQuantify requires that at least OspreyLoad , OspreyProcess and OspreyFit have been run before - any metrics involving tissue fractions require OspreyCoreg and OspreySeg as well. OspreyQuantify is invoked with the command [MRSCont] = OspreyQuantify(MRSCont); Please refer to the OspreyQuantify chapter for details on the availability of each quantification technique, detailed mathematical implementations, and the default relaxation correction values.","title":"OspreyQuantify"},{"location":"03%20-%20Quick%20Start%20Guide/#ospreyoverview","text":"OspreyOverview creates scaled individual spectra for all sub-spectra. Furthermore, the indivdual fits, baseline estimates, and residuals are stored. For each of the before mentioned measures the mean and the standard deviation are calculated. If different groups are passed through the external csv file the data is separated based on the corresponding groups. OspreyOverview requires that at least OspreyLoad , OspreyProcess and OspreyFit have been run before. OspreyOverview is invoked with the command [MRSCont] = OspreyOverview(MRSCont); Please refer to the OspreyOverview chapter for details on the scaling and how correlation measures are stored.","title":"OspreyOverview"},{"location":"03%20-%20Quick%20Start%20Guide/#ospreygui","text":"At any given point during your analysis, you can invoke the Osprey GUI to visualize the above steps. The Osprey GUI contains several tabs representing the various stages of the Osprey workflow, i.e. Load , Process , Fit , Coreg/Seg , and Quantify . It allows the export of different figures as esp files. In addition, various useful summary plots and basic statistical evaluations of the quantitative results are shown in the Overview tab. This tab gets activated only if more than one dataset has been fully analyzed. The GUI can be initialized using the command. OspreyStartUp All of the above-mentioned analysis steps can also be called from inside the GUI using the respective buttons. Please refer to the OspreyGUI chapter for details. You can also load a MRSCont from your MATLAB workspace into the GUI by using gui = OspreyGUIapp(MRSCont);","title":"OspreyGUI"},{"location":"01-getting-started/01-system-requirements/","text":"System requirements \u00b6 Osprey requires MATLAB and has been tested on version 2017a and newer. The following toolboxes are required for full functionality: Image Processing Optimization Signal Processing Statistics and Machine Learning Info You may need to ask your system administrator for a separate license for missing toolboxes. You can check your current MATLAB version and the available toolboxes with the following command at the MATLAB prompt: >> ver ----------------------------------------------------------------------------------------------------- MATLAB Version: 9.4.0.949201 (R2018a) Update 6 MATLAB License Number: 703789 Operating System: Mac OS X Version: 10.14.6 Build: 18G4032 Java Version: Java 1.8.0_144-b01 with Oracle Corporation Java HotSpot(TM) 64-Bit Server VM mixed mode ----------------------------------------------------------------------------------------------------- MATLAB Version 9.4 (R2018a) Curve Fitting Toolbox Version 3.5.7 (R2018a) GUI Layout Toolbox Version 2.3.4 (R2018b) Global Optimization Toolbox Version 3.4.4 (R2018a) Image Processing Toolbox Version 10.2 (R2018a) Neural Network Toolbox Version 11.1 (R2018a) Optimization Toolbox Version 8.1 (R2018a) Parallel Computing Toolbox Version 6.12 (R2018a) Signal Processing Toolbox Version 8.0 (R2018a) Statistics and Machine Learning Toolbox Version 11.3 (R2018a) Symbolic Math Toolbox Version 8.1 (R2018a) Wavelet Toolbox Version 5.0 (R2018a) Widgets Toolbox Version 1.3.330 (R2019a)","title":"System requirements"},{"location":"01-getting-started/01-system-requirements/#system-requirements","text":"Osprey requires MATLAB and has been tested on version 2017a and newer. The following toolboxes are required for full functionality: Image Processing Optimization Signal Processing Statistics and Machine Learning Info You may need to ask your system administrator for a separate license for missing toolboxes. You can check your current MATLAB version and the available toolboxes with the following command at the MATLAB prompt: >> ver ----------------------------------------------------------------------------------------------------- MATLAB Version: 9.4.0.949201 (R2018a) Update 6 MATLAB License Number: 703789 Operating System: Mac OS X Version: 10.14.6 Build: 18G4032 Java Version: Java 1.8.0_144-b01 with Oracle Corporation Java HotSpot(TM) 64-Bit Server VM mixed mode ----------------------------------------------------------------------------------------------------- MATLAB Version 9.4 (R2018a) Curve Fitting Toolbox Version 3.5.7 (R2018a) GUI Layout Toolbox Version 2.3.4 (R2018b) Global Optimization Toolbox Version 3.4.4 (R2018a) Image Processing Toolbox Version 10.2 (R2018a) Neural Network Toolbox Version 11.1 (R2018a) Optimization Toolbox Version 8.1 (R2018a) Parallel Computing Toolbox Version 6.12 (R2018a) Signal Processing Toolbox Version 8.0 (R2018a) Statistics and Machine Learning Toolbox Version 11.3 (R2018a) Symbolic Math Toolbox Version 8.1 (R2018a) Wavelet Toolbox Version 5.0 (R2018a) Widgets Toolbox Version 1.3.330 (R2019a)","title":"System requirements"},{"location":"01-getting-started/02-installing-osprey/","text":"Installing Osprey \u00b6 Get the latest Osprey code from our GitHub repository : Clone the repository, or download and extract the contents of the .ZIP file to a directory on your drive. Add the entire osprey directory (with subfolders) to your MATLAB path. Make sure to regularly check the repository for updates, as we frequently commit new features, bug fixes, and improved functions. To perform voxel co-registration and tissue segmentation, download SPM12 from the University College London website . You will need to provide the SPM team with some information before you can access the download link. Extract the downloaded archive so that the spm12 folder is on the same directory level as the osprey folder: Add the spm12 folder to your MATLAB path, but without subfolders - during testing, we have found that adding SPM subfolders to the MATLAB path can cause functions to fail. If you want to use the Osprey Graphical User Interface (GUI), please download the following toolboxes from the MATLAB File Exchange: GUI Layout Toolbox (David Sampson) Widget Toolbox (Robin Jackey) Download both toolboxes in the MATLAB toolbox format (.mltbx). You can double-click to install. MATLAB will automatically add the toolboxes to its path.","title":"Installing Osprey"},{"location":"01-getting-started/02-installing-osprey/#installing-osprey","text":"Get the latest Osprey code from our GitHub repository : Clone the repository, or download and extract the contents of the .ZIP file to a directory on your drive. Add the entire osprey directory (with subfolders) to your MATLAB path. Make sure to regularly check the repository for updates, as we frequently commit new features, bug fixes, and improved functions. To perform voxel co-registration and tissue segmentation, download SPM12 from the University College London website . You will need to provide the SPM team with some information before you can access the download link. Extract the downloaded archive so that the spm12 folder is on the same directory level as the osprey folder: Add the spm12 folder to your MATLAB path, but without subfolders - during testing, we have found that adding SPM subfolders to the MATLAB path can cause functions to fail. If you want to use the Osprey Graphical User Interface (GUI), please download the following toolboxes from the MATLAB File Exchange: GUI Layout Toolbox (David Sampson) Widget Toolbox (Robin Jackey) Download both toolboxes in the MATLAB toolbox format (.mltbx). You can double-click to install. MATLAB will automatically add the toolboxes to its path.","title":"Installing Osprey"},{"location":"01-getting-started/03-organize-data/","text":"How to organize your raw data \u00b6 Raw MRS data come in an overwhelming variety of formats, each producing different numbers of files. Osprey does not make a lot of assumptions with regard to your folder structure, since you specify the exact location for each file in a job file prior to each analysis. It is highly recommended, however, that you store different acquisitions in separate folders. Organizing your raw data in a consistent and meaningful way will save you a lot of time and nerves. To ensure optimal functioning of Osprey , we suggest adapting the folder hierarchy proposed by the BIDS (Brain Imaging Data Structure) initiative : There are four main levels of the folder hierarchy, these are: project/ \u2514\u2500\u2500 subject \u2514\u2500\u2500 session \u2514\u2500\u2500 acquisition With the exception of the top-level project folder, all sub-folders have a specific structure to their name (described below). Here's an example of how this hierarchy looks: myProject/ \u2514\u2500\u2500 sub-01 \u2514\u2500\u2500 ses-01 \u2514\u2500\u2500 anat An example adaptation of this hierarchy for Philips MRS data could look like this: myProject/ \u251c\u2500\u2500 sub-01 \u2502 \u2514\u2500\u2500 ses-01 \u2502 \u251c\u2500\u2500 anat \u2502 \u2502 \u2514\u2500\u2500 sub-01_T1w.nii \u2502 \u2514\u2500\u2500 mrs \u2502 \u251c\u2500\u2500 sub-01_mega-press_act \u2502 \u2502 \u251c\u2500\u2500 sub-01_mega-press_act.sdat \u2502 \u2502 \u2514\u2500\u2500 sub-01_mega-press_act.spar \u2502 \u251c\u2500\u2500 sub-01_mega-press_ref \u2502 \u2502 \u251c\u2500\u2500 sub-01_mega-press_ref.sdat \u2502 \u2502 \u2514\u2500\u2500 sub-01_mega-press_ref.spar \u2502 \u2514\u2500\u2500 sub-01_press-water \u2502 \u251c\u2500\u2500 sub-01_press-water_act.sdat \u2502 \u2514\u2500\u2500 sub-01_press-water_act.spar \u251c\u2500\u2500 sub-02 \u2502 \u2514\u2500\u2500 ses-01 \u2502 \u251c\u2500\u2500 anat \u2502 \u2502 \u2514\u2500\u2500 sub-02_T1w.nii \u2502 \u2514\u2500\u2500 mrs \u2502 \u251c\u2500\u2500 sub-02_mega-press_act \u2502 \u2502 \u251c\u2500\u2500 sub-02_mega-press_act.sdat \u2502 \u2502 \u2514\u2500\u2500 sub-02_mega-press_act.spar \u2502 \u251c\u2500\u2500 sub-02_mega-press_ref \u2502 \u2502 \u251c\u2500\u2500 sub-02_mega-press_ref.sdat \u2502 \u2502 \u2514\u2500\u2500 sub-02_mega-press_ref.spar \u2502 \u2514\u2500\u2500 sub-02_press-water \u2502 \u251c\u2500\u2500 sub-02_press-water_act.sdat \u2502 \u2514\u2500\u2500 sub-02_press-water_act.spar ... ... While adhering to the BIDS standard is a recommendation, it is by no means binding for most file formats. You can, for example, keep Siemens TWIX files ( .dat ) all in the same folder, and Osprey will be able to handle them, if you define their paths in the job file accordingly. Warning There is one exception: For data stored in single-average DICOM ( *.IMA , *.DCM ) or single-average Siemens RDA format, it is absolutely necessary to keep every scan in a separate folder.","title":"How to organize your raw data"},{"location":"01-getting-started/03-organize-data/#how-to-organize-your-raw-data","text":"Raw MRS data come in an overwhelming variety of formats, each producing different numbers of files. Osprey does not make a lot of assumptions with regard to your folder structure, since you specify the exact location for each file in a job file prior to each analysis. It is highly recommended, however, that you store different acquisitions in separate folders. Organizing your raw data in a consistent and meaningful way will save you a lot of time and nerves. To ensure optimal functioning of Osprey , we suggest adapting the folder hierarchy proposed by the BIDS (Brain Imaging Data Structure) initiative : There are four main levels of the folder hierarchy, these are: project/ \u2514\u2500\u2500 subject \u2514\u2500\u2500 session \u2514\u2500\u2500 acquisition With the exception of the top-level project folder, all sub-folders have a specific structure to their name (described below). Here's an example of how this hierarchy looks: myProject/ \u2514\u2500\u2500 sub-01 \u2514\u2500\u2500 ses-01 \u2514\u2500\u2500 anat An example adaptation of this hierarchy for Philips MRS data could look like this: myProject/ \u251c\u2500\u2500 sub-01 \u2502 \u2514\u2500\u2500 ses-01 \u2502 \u251c\u2500\u2500 anat \u2502 \u2502 \u2514\u2500\u2500 sub-01_T1w.nii \u2502 \u2514\u2500\u2500 mrs \u2502 \u251c\u2500\u2500 sub-01_mega-press_act \u2502 \u2502 \u251c\u2500\u2500 sub-01_mega-press_act.sdat \u2502 \u2502 \u2514\u2500\u2500 sub-01_mega-press_act.spar \u2502 \u251c\u2500\u2500 sub-01_mega-press_ref \u2502 \u2502 \u251c\u2500\u2500 sub-01_mega-press_ref.sdat \u2502 \u2502 \u2514\u2500\u2500 sub-01_mega-press_ref.spar \u2502 \u2514\u2500\u2500 sub-01_press-water \u2502 \u251c\u2500\u2500 sub-01_press-water_act.sdat \u2502 \u2514\u2500\u2500 sub-01_press-water_act.spar \u251c\u2500\u2500 sub-02 \u2502 \u2514\u2500\u2500 ses-01 \u2502 \u251c\u2500\u2500 anat \u2502 \u2502 \u2514\u2500\u2500 sub-02_T1w.nii \u2502 \u2514\u2500\u2500 mrs \u2502 \u251c\u2500\u2500 sub-02_mega-press_act \u2502 \u2502 \u251c\u2500\u2500 sub-02_mega-press_act.sdat \u2502 \u2502 \u2514\u2500\u2500 sub-02_mega-press_act.spar \u2502 \u251c\u2500\u2500 sub-02_mega-press_ref \u2502 \u2502 \u251c\u2500\u2500 sub-02_mega-press_ref.sdat \u2502 \u2502 \u2514\u2500\u2500 sub-02_mega-press_ref.spar \u2502 \u2514\u2500\u2500 sub-02_press-water \u2502 \u251c\u2500\u2500 sub-02_press-water_act.sdat \u2502 \u2514\u2500\u2500 sub-02_press-water_act.spar ... ... While adhering to the BIDS standard is a recommendation, it is by no means binding for most file formats. You can, for example, keep Siemens TWIX files ( .dat ) all in the same folder, and Osprey will be able to handle them, if you define their paths in the job file accordingly. Warning There is one exception: For data stored in single-average DICOM ( *.IMA , *.DCM ) or single-average Siemens RDA format, it is absolutely necessary to keep every scan in a separate folder.","title":"How to organize your raw data"},{"location":"02-osprey-workflow/01-structure-workflow/","text":"The Osprey Workflow \u00b6 Osprey was designed to have an easy, linear workflow with as little user input as possible. It has many built-in routines to recognize data formats and sequence types, and will be able to perform most required processing steps automatically. Osprey consists of seven separate modules \u2013 Job, Load, Proc, Fit, Coreg, Seg, and Quant, all of which are sequentially called in a graphical user interface. Alternatively, users can conduct the entire workflow from the MATLAB command prompt. The Osprey workflow. Some input will need to be provided by the user in the form of a job . A job specifies the locations of the files containing MRS and structural imaging data, the type of MRS sequence, and some basic control options over the data modeling procedure. While a job is progressing through the Osprey pipeline, all raw and processed data associated with this job are stored in a MATLAB structure, the Osprey data container . By default, this container is called MRSCont , but you are free to give it a more meaningful variable name. Osprey 's data handling is based in large parts on the free MATLAB toolbox FID-A . The Osprey folder contains a library of, sometimes modified, FID-A functions and additions. Please make sure that you do not include an installation of the original FID-A suite in your MATLAB path, as some functions in the Osprey folder might be shadowed by FID-A functions with the same name. The MRSCont data container functions as a super-structure, containing FID-A structures for each dataset and processing step, along with additional information, e.g. quality metrics, quantification results, etc.","title":"The Osprey Workflow"},{"location":"02-osprey-workflow/01-structure-workflow/#the-osprey-workflow","text":"Osprey was designed to have an easy, linear workflow with as little user input as possible. It has many built-in routines to recognize data formats and sequence types, and will be able to perform most required processing steps automatically. Osprey consists of seven separate modules \u2013 Job, Load, Proc, Fit, Coreg, Seg, and Quant, all of which are sequentially called in a graphical user interface. Alternatively, users can conduct the entire workflow from the MATLAB command prompt. The Osprey workflow. Some input will need to be provided by the user in the form of a job . A job specifies the locations of the files containing MRS and structural imaging data, the type of MRS sequence, and some basic control options over the data modeling procedure. While a job is progressing through the Osprey pipeline, all raw and processed data associated with this job are stored in a MATLAB structure, the Osprey data container . By default, this container is called MRSCont , but you are free to give it a more meaningful variable name. Osprey 's data handling is based in large parts on the free MATLAB toolbox FID-A . The Osprey folder contains a library of, sometimes modified, FID-A functions and additions. Please make sure that you do not include an installation of the original FID-A suite in your MATLAB path, as some functions in the Osprey folder might be shadowed by FID-A functions with the same name. The MRSCont data container functions as a super-structure, containing FID-A structures for each dataset and processing step, along with additional information, e.g. quality metrics, quantification results, etc.","title":"The Osprey Workflow"},{"location":"03-job-files/01-the-job-file/","text":"The Osprey job file \u00b6 Every Osprey analysis requires the user to provide a job file. The Osprey job file is the only direct point of contact between the user and the analysis. It contains paths to MRS data files and structural images, defines processing and modelling options, and determines whether (and where) output files are being saved. The job file system ensures that all processing, modeling, and quantification steps are performed in an operator-independent, reproducible way. Example job file \u00b6 The following collapsible box contains the example job file jobSDAT.m defining a batched analysis of the two Philips PRESS (TE = 30 ms) datasets that are included in the exampledata/sdat/ directory of the Osprey repository . You can click on the dropdown arrow on the right to take a look through the file, and then read on for a detailed description of each job file item. Example job file jobSDAT.m : %% jobSDAT.m % This function describes an Osprey job defined in a MATLAB script. % % A valid Osprey job contains four distinct classes of items: % 1. basic information on the MRS sequence used % 2. several settings for data handling and modeling % 3. a list of MRS (and, optionally, structural imaging) data files % to be loaded % 4. an output folder to store the results and exported files % % The list of MRS and structural imaging files is provided in the form of % cell arrays. They can simply be provided explicitly, or from a more % complex script that automatically determines file names from a given % folder structure. % % Osprey distinguishes between four sets of data: % - metabolite (water-suppressed) data % (MANDATORY) % Defined in cell array \"files\" % - water reference data acquired with the SAME sequence as the % metabolite data, just without water suppression RF pulses. This % data is used to determine complex coil combination % coefficients, and perform eddy current correction. % (OPTIONAL) % Defined in cell array \"files_ref\" % - additional water data used for water-scaled quantification, % usually from short-TE acquisitions due to reduced T2-weighting % (OPTIONAL) % Defined in cell array \"files_w\" % - Structural image data used for co-registration and tissue class % segmentation (usually a T1 MPRAGE). These files need to be % provided in the NIfTI format (*.nii) or, for GE data, as a % folder containing DICOM Files (*.dcm). % (OPTIONAL) % Defined in cell array \"files_nii\" % % Files in the formats % - .7 (GE) % - .SDAT, .DATA/.LIST, .RAW/.SIN/.LAB (Philips) % - .DAT (Siemens) % usually contain all of the acquired data in a single file per scan. GE % systems store water reference data in the same .7 file, so there is no % need to specify it separately under files_ref. % % Files in the formats % - .DCM (any) % - .IMA, .RDA (Siemens) % may contain separate files for each average. Instead of providing % individual file names, please specify folders. Metabolite data, water % reference data, and water data need to be located in separate folders. % % In the example script at hand the MATLAB functions strrep and which are % used to generate a relative path, which allows you to run the examples % on your machine directly. To set up your own Osprey job supply the % specific locations as described above. % % AUTHOR: % Dr. Georg Oeltzschner (Johns Hopkins University, 2019-07-15) % goeltzs1@jhmi.edu % % HISTORY: % 2019-07-15: First version of the code. %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% 1. SPECIFY SEQUENCE INFORMATION %%% % Specify sequence type seqType = 'unedited' ; % OPTIONS: - 'unedited' (default) % - 'MEGA' % - 'HERMES' % - 'HERCULES' % Specify editing targets editTarget = { 'none' }; % OPTIONS: - {'none'} (default if 'unedited') % - {'GABA'}, {'GSH'} (for 'MEGA') % - {'GABA, 'GSH}, {'GABA, GSH, EtOH'} (for 'HERMES') % - {'HERCULES1'}, {'HERCULES2'} (for 'HERCULES') %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% 2. SPECIFY DATA HANDLING AND MODELING OPTIONS %%% % Save LCModel-exportable files for each spectrum? opts . saveLCM = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Save jMRUI-exportable files for each spectrum? opts . saveJMRUI = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Save processed spectra in vendor-specific format (SDAT/SPAR, RDA, P)? opts . saveVendor = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Choose the fitting algorithm opts . fit . method = 'Osprey' ; % OPTIONS: - 'Osprey' (default) % - 'AQSES' (planned) % - 'TARQUIN' (planned) % Choose the fitting style for difference-edited datasets (MEGA, HERMES, HERCULES) % (only available for the Osprey fitting method) opts . fit . style = 'Concatenated' ; % OPTIONS: - 'Concatenated' (default) - will fit DIFF and SUM simultaneously) % - 'Separate' - will fit DIFF and OFF separately % Determine fitting range (in ppm) for the metabolite and water spectra opts . fit . range = [ 0.2 4.2 ]; % [ppm] Default: [0.2 4.2] opts . fit . rangeWater = [ 2.0 7.4 ]; % [ppm] Default: [2.0 7.4] % Determine the baseline knot spacing (in ppm) for the metabolite spectra opts . fit . bLineKnotSpace = 0.4 ; % [ppm] Default: 0.4. % Add macromolecule and lipid basis functions to the fit? opts . fit . fitMM = 1 ; % OPTIONS: - 0 (no) % - 1 (yes, default) %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% 3. SPECIFY MRS DATA AND STRUCTURAL IMAGING FILES %% % When using single-average Siemens RDA or DICOM files, specify their % folders instead of single files! % Specify metabolite data % (MANDATORY) files = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press/sub-01_PRESS_35_act.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press/sub-02_PRESS_35_act.sdat' )}; % Specify water reference data for eddy-current correction (same sequence as metabolite data!) % (OPTIONAL) % Leave empty for GE P-files (.7) - these include water reference data by % default. files_ref = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat' )}; % Specify water data for quantification (e.g. short-TE water scan) % (OPTIONAL) files_w = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat' )}; % Specify T1-weighted structural imaging data % (OPTIONAL) % Link to single NIfTI (*.nii) files for Siemens and Philips data % Link to DICOM (*.dcm) folders for GE data files_nii = { which ( 'exampledata/sdat/sub-01/anat/sub-01_T1w.nii' ), ... which ( 'exampledata/sdat/sub-02/anat/sub-02_T1w.nii' )}; %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% 4. SPECIFY OUTPUT FOLDER %% % The Osprey data container will be saved as a *.mat file in the output % folder that you specify below. In addition, any exported files (for use % with jMRUI, TARQUIN, or LCModel) will be saved in sub-folders. % Specify output folder % (MANDATORY) outputFolder = strrep ( which ( 'exampledata/sdat/jobSDAT.m' ), 'jobSDAT.m' , 'derivatives' ); %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 1. Sequence Information \u00b6 In this section of the job file, you determine basic information on the type of sequence you used. Sequence Type \u00b6 MANDATORY The seqType variable is a describes the sequence type, and is a required input in the form of a string. seqType determines whether the supplied datasets have been acquired with spectral editing experiments. % Specify sequence type seqType = 'unedited' ; % OPTIONS: - 'unedited' (default) % - 'MEGA' % - 'HERMES' % - 'HERCULES' Editing Targets \u00b6 MANDATORY The editTarget variable describes the sequence type, and is a required input in the form of a cell array. editTarget determines the target spin system(s) of spectral editing experiments. If no spectral editing has been performed, enter {'none'} . % Specify editing targets editTarget = { 'none' }; % OPTIONS: - {'none'} (default if 'unedited') % - {'GABA'}, {'GSH'} (for 'MEGA') % - {'GABA, 'GSH}, {'GABA, GSH, EtOH'} (for 'HERMES') % - {'HERCULES1'}, {'HERCULES2'} (for 'HERCULES') 2. Data handling and modeling options \u00b6 In this section of the job file, you provide information on whether you would like to save the processed data in externally usable file formats (for example, if you want to interface your analysis with LCModel), and specify options for the modelling. Saving data to external formats \u00b6 OPTIONAL The opts.save variable set determines whether Osprey saves the processed data in formats that can be interfaced with external analysis software. By setting opts.saveLCM to 1 , LCModel-readable .RAW files are produced. By setting opts.saveJMRUI to 1 , jMRUI/Tarquin-readable .TXT files are produced. By setting opts.saveVendor to 1 , single vendor-specific files are created, i.e. .SDAT/.SPAR files for Philips data, and .RDA files for Siemens data, regardless of the raw data format. % Save LCModel-exportable files for each spectrum? opts . saveLCM = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Save jMRUI-exportable files for each spectrum? opts . saveJMRUI = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Save processed spectra in vendor-specific format (SDAT/SPAR, RDA, P)? opts . saveVendor = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) LCModel .RAW files can be loaded via the Other option in the LCModel file type selection menu. Please be aware that LCModel may prompt you to enter the number of FID data points (a positive integer number, e.g. 2048 ), dwell time (in seconds, e.g. 0.0005 ), and the static magnetic field strength in MHz (e.g. 123.26 for a Siemens 2.89 T magnet). When loading .TXT files with Tarquin, you will probably need to enter the echo time in seconds (e.g. 0.03 for a TE = 30 ms acquisition). The opts.saveVendor switch has been introduced to sidestep these problems with .RAW and .TXT files. LCModel, TARQUIN and jMRUI accept the .SDAT/.SPAR and .RDA file formats, and should be able to read the header information correctly. All exported third-party format files are stored in sub-directories of the output folder specified further down in the job file. Specifying fitting options \u00b6 MANDATORY The opts.fit.method variable set determines the modelling algorithm used to fit the processed spectra. Currently, the only available option is the default Osprey model. We are planning to implement other algorithms in the future. % Choose the fitting algorithm opts . fit . method = 'Osprey' ; % OPTIONS: - 'Osprey' (default) % - 'AQSES' (planned) % - 'TARQUIN' (planned) MANDATORY The opts.fit.style variable set determines how difference-edited data are modeled. By setting opts.fit.style to Concatenated , the difference and sum spectra in MEGA, HERMES and HERCULES datasets will be modeled simultaneously, i.e. with common metabolite amplitude parameters across these spectra. By setting opts.fit.style to Separate , the difference and edit-OFF spectra in MEGA, HERMES and HERCULES datasets will be modeled independently. In this case, the creatine reference signal will be determined from the edit-OFF spectrum. % Choose the fitting style for difference-edited datasets (MEGA, HERMES, HERCULES) % (only available for the Osprey fitting method) opts . fit . style = 'Concatenated' ; % OPTIONS: - 'Concatenated' (default) - will fit DIFF and SUM simultaneously) % - 'Separate' - will fit DIFF and OFF separately MANDATORY The opts.fit.range and opts.fit.rangeWater variables determine the fitting range (in ppm) of the metabolite and water spectra, respectively. % Determine fitting range (in ppm) for the metabolite and water spectra opts . fit . range = [ 0.2 4.2 ]; % [ppm] Default: [0.2 4.2] opts . fit . rangeWater = [ 2.0 7.4 ]; % [ppm] Default: [2.0 7.4] MANDATORY The opts.fit.bLineKnotSpace variable determines the spacing (in ppm) between two adjacent knots of the cubic B-spline baseline. This parameter is equivalent to the DKNTMN parameter in LCModel. Higher values correspond to a stiffer baseline, while lower values will produce a larger number of spline knots, allowing for greater flexibility of the baseline. % Determine the baseline knot spacing (in ppm) for the metabolite spectra opts . fit . bLineKnotSpace = 0.4 ; % [ppm] Default: 0.4. Choosing lower values for the bLineKnotSpace variable will improve the fit quality at the expense of overparametrization of the model. LCModel uses a default knot spacing of DKNTMN = 0.15 , i.e. 0.15 ppm, which likely allows too much flexibility. In the absence of baseline regularization in the current stage of the Osprey model development, we chose to restrict baseline flexibility by opting for a default value of 0.4 ppm. MANDATORY The opts.fit.fitMM variable determines whether simulated Gaussian signals representing broad macromolecular and lipid signals are included in the basis set. By default, Osprey includes these basis functions. If you want to use an experimentally measured MM/lipid basis function, or operate at long echo times where the MM and lipid resonances have decayed, you can set opts.fit.fitMM = 0 to exclude them. % Add macromolecule and lipid basis functions to the fit? opts . fit . fitMM = 1 ; % OPTIONS: - 0 (no) % - 1 (yes, default) 3. Specifying MRS data and structural imaging files \u00b6 In this section of the job file, you specify the full paths to the MRS data and structural imaging files that you would like to process and analyze. Osprey is designed for the batch analysis of multiple datasets in one session. Each dataset corresponds to an element of a cell array. The cell arrays for metabolite data, water reference data, short-TE water data, and structural imaging files need to have the same number of elements. For example, if you have MRS data from two voxels in the same subject, you need to enter the path to the .NII structural twice into the files_nii cell array. At the current stage of implementation, you can only analyze one type of sequence per job file, i.e. if you have MEGA-PRESS and PRESS data for each subject, you will have to design two separate job files for MEGA-PRESS and PRESS data. Metabolite data \u00b6 MANDATORY The files variable is defined as a cell array of full paths to the raw MRS data files containing your metabolite (water-suppressed) data. % Specify metabolite data % (MANDATORY) files = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press/sub-01_PRESS_35_act.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press/sub-02_PRESS_35_act.sdat' )}; In the job files in the exampledata folder of the Osprey repository, the which function ensures that the paths are correctly defined regardless of where you put your Osprey folder. When designing your own job file, you will have to provide the full paths to your raw data, e.g.: % Specify metabolite data % (MANDATORY) files = { '/Users/Georg/Documents/MRSData/study-01/sub-01/mrs/sub-01_press/sub-01_PRESS_35_act.sdat' , ... '/Users/Georg/Documents/MRSData/study-01/sub-02/mrs/sub-02_press/sub-02_PRESS_35_act.sdat' ,}; Instead of writing out the full paths explicitly, you can also create a procedure that is tailored to your local file organization, as long as you end up with a files cell array containing an element for each file you want to analyze. Single-average DICOM and Siemens RDA datasets MRS raw data can be exported in DICOM and Siemens RDA format, where each average is saved as a separate .DCM or .RDA file. In this case, you have to enter the full path to the folder containing all single-average files belong to one acquisition . Please refer to the data organization chapter of this documentation for best practices on creating a useful folder structure for your raw data. Lineshape reference data \u00b6 OPTIONAL The files_ref variable is defined as a cell array of full paths to the raw MRS data files to your lineshape (water-unsuppressed) reference data. These are an optional input, acquired with the same sequence as the metabolite data, but without water suppression, and used to perform eddy-current correction of the metabolite data. % Specify water reference data for eddy-current correction (same sequence as metabolite data!) % (OPTIONAL) % Leave empty for GE P-files (.7) - these include water reference data by % default. files_ref = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat' )}; If only lineshape reference data are provided, this signal is also used to calculate water-scaled concentration estimates. Short-TE water data \u00b6 OPTIONAL The files_w variable is defined as a cell array of full paths to the raw MRS data files to short-TE water data. These are another optional input, and can be used to derive water-scaled concentration estimates (while lineshape reference data are only used for eddy-current correction). Using short-TE water as the concentration reference standard reduces T2-weighting of the water reference signal (and associated correction errors) compared to long-TE water data. % Specify water data for quantification (e.g. short-TE water scan) % (OPTIONAL) files_w = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat' )}; Structural images \u00b6 OPTIONAL The files_nii variable is defined as a cell array of full paths to T1-weighted structural images used for co-registration and segmentation purposes. Osprey requires NIfTI ( .nii ) files to be supplied. For GE files, you may also provide the full path to a directory containing the DICOM folders corresponding to the T1 acquisition. % Specify T1-weighted structural imaging data % (OPTIONAL) % Link to single NIfTI (.nii) files for Siemens and Philips data % Link to DICOM (.dcm) folders for GE data files_nii = { which ( 'exampledata/sdat/sub-01/anat/sub-01_T1w.nii' ), ... which ( 'exampledata/sdat/sub-02/anat/sub-02_T1w.nii' )}; Osprey uses SPM12 functions to load and process structural images. Please refer to the installation instructions for information on how to set up SPM12. 4. Specifying the output folder \u00b6 In this section of the job file, you specify the full paths to an output folder where the Osprey data container is saved in .mat format. In addition, any exported files (for use with jMRUI, TARQUIN, or LCModel) will be saved in separate sub-folders of the output folder. MANDATORY The outputFolder variable specifies a full path to the output folder. If the output folder does not exist yet, it will be created. % Specify output folder % (MANDATORY) outputFolder = strrep ( which ( 'exampledata/sdat/jobSDAT.m' ), 'jobSDAT.m' , 'derivatives' ); In the job files in the example folder of the Osprey repository, the which and strrep functions ensures that an output folder derivatives in the folder where the job file jobSDAT resides. When designing your own job file, you will have to provide the full path to your desired output folder. Note that Osprey detects if the output folder already exists and contains data from a previous analysis. In this case, you will be prompted whether you would like to overwrite the existing output.","title":"Job files"},{"location":"03-job-files/01-the-job-file/#the-osprey-job-file","text":"Every Osprey analysis requires the user to provide a job file. The Osprey job file is the only direct point of contact between the user and the analysis. It contains paths to MRS data files and structural images, defines processing and modelling options, and determines whether (and where) output files are being saved. The job file system ensures that all processing, modeling, and quantification steps are performed in an operator-independent, reproducible way.","title":"The Osprey job file"},{"location":"03-job-files/01-the-job-file/#example-job-file","text":"The following collapsible box contains the example job file jobSDAT.m defining a batched analysis of the two Philips PRESS (TE = 30 ms) datasets that are included in the exampledata/sdat/ directory of the Osprey repository . You can click on the dropdown arrow on the right to take a look through the file, and then read on for a detailed description of each job file item. Example job file jobSDAT.m : %% jobSDAT.m % This function describes an Osprey job defined in a MATLAB script. % % A valid Osprey job contains four distinct classes of items: % 1. basic information on the MRS sequence used % 2. several settings for data handling and modeling % 3. a list of MRS (and, optionally, structural imaging) data files % to be loaded % 4. an output folder to store the results and exported files % % The list of MRS and structural imaging files is provided in the form of % cell arrays. They can simply be provided explicitly, or from a more % complex script that automatically determines file names from a given % folder structure. % % Osprey distinguishes between four sets of data: % - metabolite (water-suppressed) data % (MANDATORY) % Defined in cell array \"files\" % - water reference data acquired with the SAME sequence as the % metabolite data, just without water suppression RF pulses. This % data is used to determine complex coil combination % coefficients, and perform eddy current correction. % (OPTIONAL) % Defined in cell array \"files_ref\" % - additional water data used for water-scaled quantification, % usually from short-TE acquisitions due to reduced T2-weighting % (OPTIONAL) % Defined in cell array \"files_w\" % - Structural image data used for co-registration and tissue class % segmentation (usually a T1 MPRAGE). These files need to be % provided in the NIfTI format (*.nii) or, for GE data, as a % folder containing DICOM Files (*.dcm). % (OPTIONAL) % Defined in cell array \"files_nii\" % % Files in the formats % - .7 (GE) % - .SDAT, .DATA/.LIST, .RAW/.SIN/.LAB (Philips) % - .DAT (Siemens) % usually contain all of the acquired data in a single file per scan. GE % systems store water reference data in the same .7 file, so there is no % need to specify it separately under files_ref. % % Files in the formats % - .DCM (any) % - .IMA, .RDA (Siemens) % may contain separate files for each average. Instead of providing % individual file names, please specify folders. Metabolite data, water % reference data, and water data need to be located in separate folders. % % In the example script at hand the MATLAB functions strrep and which are % used to generate a relative path, which allows you to run the examples % on your machine directly. To set up your own Osprey job supply the % specific locations as described above. % % AUTHOR: % Dr. Georg Oeltzschner (Johns Hopkins University, 2019-07-15) % goeltzs1@jhmi.edu % % HISTORY: % 2019-07-15: First version of the code. %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% 1. SPECIFY SEQUENCE INFORMATION %%% % Specify sequence type seqType = 'unedited' ; % OPTIONS: - 'unedited' (default) % - 'MEGA' % - 'HERMES' % - 'HERCULES' % Specify editing targets editTarget = { 'none' }; % OPTIONS: - {'none'} (default if 'unedited') % - {'GABA'}, {'GSH'} (for 'MEGA') % - {'GABA, 'GSH}, {'GABA, GSH, EtOH'} (for 'HERMES') % - {'HERCULES1'}, {'HERCULES2'} (for 'HERCULES') %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% 2. SPECIFY DATA HANDLING AND MODELING OPTIONS %%% % Save LCModel-exportable files for each spectrum? opts . saveLCM = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Save jMRUI-exportable files for each spectrum? opts . saveJMRUI = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Save processed spectra in vendor-specific format (SDAT/SPAR, RDA, P)? opts . saveVendor = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Choose the fitting algorithm opts . fit . method = 'Osprey' ; % OPTIONS: - 'Osprey' (default) % - 'AQSES' (planned) % - 'TARQUIN' (planned) % Choose the fitting style for difference-edited datasets (MEGA, HERMES, HERCULES) % (only available for the Osprey fitting method) opts . fit . style = 'Concatenated' ; % OPTIONS: - 'Concatenated' (default) - will fit DIFF and SUM simultaneously) % - 'Separate' - will fit DIFF and OFF separately % Determine fitting range (in ppm) for the metabolite and water spectra opts . fit . range = [ 0.2 4.2 ]; % [ppm] Default: [0.2 4.2] opts . fit . rangeWater = [ 2.0 7.4 ]; % [ppm] Default: [2.0 7.4] % Determine the baseline knot spacing (in ppm) for the metabolite spectra opts . fit . bLineKnotSpace = 0.4 ; % [ppm] Default: 0.4. % Add macromolecule and lipid basis functions to the fit? opts . fit . fitMM = 1 ; % OPTIONS: - 0 (no) % - 1 (yes, default) %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% 3. SPECIFY MRS DATA AND STRUCTURAL IMAGING FILES %% % When using single-average Siemens RDA or DICOM files, specify their % folders instead of single files! % Specify metabolite data % (MANDATORY) files = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press/sub-01_PRESS_35_act.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press/sub-02_PRESS_35_act.sdat' )}; % Specify water reference data for eddy-current correction (same sequence as metabolite data!) % (OPTIONAL) % Leave empty for GE P-files (.7) - these include water reference data by % default. files_ref = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat' )}; % Specify water data for quantification (e.g. short-TE water scan) % (OPTIONAL) files_w = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat' )}; % Specify T1-weighted structural imaging data % (OPTIONAL) % Link to single NIfTI (*.nii) files for Siemens and Philips data % Link to DICOM (*.dcm) folders for GE data files_nii = { which ( 'exampledata/sdat/sub-01/anat/sub-01_T1w.nii' ), ... which ( 'exampledata/sdat/sub-02/anat/sub-02_T1w.nii' )}; %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% 4. SPECIFY OUTPUT FOLDER %% % The Osprey data container will be saved as a *.mat file in the output % folder that you specify below. In addition, any exported files (for use % with jMRUI, TARQUIN, or LCModel) will be saved in sub-folders. % Specify output folder % (MANDATORY) outputFolder = strrep ( which ( 'exampledata/sdat/jobSDAT.m' ), 'jobSDAT.m' , 'derivatives' ); %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%","title":"Example job file"},{"location":"03-job-files/01-the-job-file/#1-sequence-information","text":"In this section of the job file, you determine basic information on the type of sequence you used.","title":"1. Sequence Information"},{"location":"03-job-files/01-the-job-file/#sequence-type","text":"MANDATORY The seqType variable is a describes the sequence type, and is a required input in the form of a string. seqType determines whether the supplied datasets have been acquired with spectral editing experiments. % Specify sequence type seqType = 'unedited' ; % OPTIONS: - 'unedited' (default) % - 'MEGA' % - 'HERMES' % - 'HERCULES'","title":"Sequence Type"},{"location":"03-job-files/01-the-job-file/#editing-targets","text":"MANDATORY The editTarget variable describes the sequence type, and is a required input in the form of a cell array. editTarget determines the target spin system(s) of spectral editing experiments. If no spectral editing has been performed, enter {'none'} . % Specify editing targets editTarget = { 'none' }; % OPTIONS: - {'none'} (default if 'unedited') % - {'GABA'}, {'GSH'} (for 'MEGA') % - {'GABA, 'GSH}, {'GABA, GSH, EtOH'} (for 'HERMES') % - {'HERCULES1'}, {'HERCULES2'} (for 'HERCULES')","title":"Editing Targets"},{"location":"03-job-files/01-the-job-file/#2-data-handling-and-modeling-options","text":"In this section of the job file, you provide information on whether you would like to save the processed data in externally usable file formats (for example, if you want to interface your analysis with LCModel), and specify options for the modelling.","title":"2. Data handling and modeling options"},{"location":"03-job-files/01-the-job-file/#saving-data-to-external-formats","text":"OPTIONAL The opts.save variable set determines whether Osprey saves the processed data in formats that can be interfaced with external analysis software. By setting opts.saveLCM to 1 , LCModel-readable .RAW files are produced. By setting opts.saveJMRUI to 1 , jMRUI/Tarquin-readable .TXT files are produced. By setting opts.saveVendor to 1 , single vendor-specific files are created, i.e. .SDAT/.SPAR files for Philips data, and .RDA files for Siemens data, regardless of the raw data format. % Save LCModel-exportable files for each spectrum? opts . saveLCM = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Save jMRUI-exportable files for each spectrum? opts . saveJMRUI = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) % Save processed spectra in vendor-specific format (SDAT/SPAR, RDA, P)? opts . saveVendor = 1 ; % OPTIONS: - 0 (no, default) % - 1 (yes) LCModel .RAW files can be loaded via the Other option in the LCModel file type selection menu. Please be aware that LCModel may prompt you to enter the number of FID data points (a positive integer number, e.g. 2048 ), dwell time (in seconds, e.g. 0.0005 ), and the static magnetic field strength in MHz (e.g. 123.26 for a Siemens 2.89 T magnet). When loading .TXT files with Tarquin, you will probably need to enter the echo time in seconds (e.g. 0.03 for a TE = 30 ms acquisition). The opts.saveVendor switch has been introduced to sidestep these problems with .RAW and .TXT files. LCModel, TARQUIN and jMRUI accept the .SDAT/.SPAR and .RDA file formats, and should be able to read the header information correctly. All exported third-party format files are stored in sub-directories of the output folder specified further down in the job file.","title":"Saving data to external formats"},{"location":"03-job-files/01-the-job-file/#specifying-fitting-options","text":"MANDATORY The opts.fit.method variable set determines the modelling algorithm used to fit the processed spectra. Currently, the only available option is the default Osprey model. We are planning to implement other algorithms in the future. % Choose the fitting algorithm opts . fit . method = 'Osprey' ; % OPTIONS: - 'Osprey' (default) % - 'AQSES' (planned) % - 'TARQUIN' (planned) MANDATORY The opts.fit.style variable set determines how difference-edited data are modeled. By setting opts.fit.style to Concatenated , the difference and sum spectra in MEGA, HERMES and HERCULES datasets will be modeled simultaneously, i.e. with common metabolite amplitude parameters across these spectra. By setting opts.fit.style to Separate , the difference and edit-OFF spectra in MEGA, HERMES and HERCULES datasets will be modeled independently. In this case, the creatine reference signal will be determined from the edit-OFF spectrum. % Choose the fitting style for difference-edited datasets (MEGA, HERMES, HERCULES) % (only available for the Osprey fitting method) opts . fit . style = 'Concatenated' ; % OPTIONS: - 'Concatenated' (default) - will fit DIFF and SUM simultaneously) % - 'Separate' - will fit DIFF and OFF separately MANDATORY The opts.fit.range and opts.fit.rangeWater variables determine the fitting range (in ppm) of the metabolite and water spectra, respectively. % Determine fitting range (in ppm) for the metabolite and water spectra opts . fit . range = [ 0.2 4.2 ]; % [ppm] Default: [0.2 4.2] opts . fit . rangeWater = [ 2.0 7.4 ]; % [ppm] Default: [2.0 7.4] MANDATORY The opts.fit.bLineKnotSpace variable determines the spacing (in ppm) between two adjacent knots of the cubic B-spline baseline. This parameter is equivalent to the DKNTMN parameter in LCModel. Higher values correspond to a stiffer baseline, while lower values will produce a larger number of spline knots, allowing for greater flexibility of the baseline. % Determine the baseline knot spacing (in ppm) for the metabolite spectra opts . fit . bLineKnotSpace = 0.4 ; % [ppm] Default: 0.4. Choosing lower values for the bLineKnotSpace variable will improve the fit quality at the expense of overparametrization of the model. LCModel uses a default knot spacing of DKNTMN = 0.15 , i.e. 0.15 ppm, which likely allows too much flexibility. In the absence of baseline regularization in the current stage of the Osprey model development, we chose to restrict baseline flexibility by opting for a default value of 0.4 ppm. MANDATORY The opts.fit.fitMM variable determines whether simulated Gaussian signals representing broad macromolecular and lipid signals are included in the basis set. By default, Osprey includes these basis functions. If you want to use an experimentally measured MM/lipid basis function, or operate at long echo times where the MM and lipid resonances have decayed, you can set opts.fit.fitMM = 0 to exclude them. % Add macromolecule and lipid basis functions to the fit? opts . fit . fitMM = 1 ; % OPTIONS: - 0 (no) % - 1 (yes, default)","title":"Specifying fitting options"},{"location":"03-job-files/01-the-job-file/#3-specifying-mrs-data-and-structural-imaging-files","text":"In this section of the job file, you specify the full paths to the MRS data and structural imaging files that you would like to process and analyze. Osprey is designed for the batch analysis of multiple datasets in one session. Each dataset corresponds to an element of a cell array. The cell arrays for metabolite data, water reference data, short-TE water data, and structural imaging files need to have the same number of elements. For example, if you have MRS data from two voxels in the same subject, you need to enter the path to the .NII structural twice into the files_nii cell array. At the current stage of implementation, you can only analyze one type of sequence per job file, i.e. if you have MEGA-PRESS and PRESS data for each subject, you will have to design two separate job files for MEGA-PRESS and PRESS data.","title":"3. Specifying MRS data and structural imaging files"},{"location":"03-job-files/01-the-job-file/#metabolite-data","text":"MANDATORY The files variable is defined as a cell array of full paths to the raw MRS data files containing your metabolite (water-suppressed) data. % Specify metabolite data % (MANDATORY) files = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press/sub-01_PRESS_35_act.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press/sub-02_PRESS_35_act.sdat' )}; In the job files in the exampledata folder of the Osprey repository, the which function ensures that the paths are correctly defined regardless of where you put your Osprey folder. When designing your own job file, you will have to provide the full paths to your raw data, e.g.: % Specify metabolite data % (MANDATORY) files = { '/Users/Georg/Documents/MRSData/study-01/sub-01/mrs/sub-01_press/sub-01_PRESS_35_act.sdat' , ... '/Users/Georg/Documents/MRSData/study-01/sub-02/mrs/sub-02_press/sub-02_PRESS_35_act.sdat' ,}; Instead of writing out the full paths explicitly, you can also create a procedure that is tailored to your local file organization, as long as you end up with a files cell array containing an element for each file you want to analyze. Single-average DICOM and Siemens RDA datasets MRS raw data can be exported in DICOM and Siemens RDA format, where each average is saved as a separate .DCM or .RDA file. In this case, you have to enter the full path to the folder containing all single-average files belong to one acquisition . Please refer to the data organization chapter of this documentation for best practices on creating a useful folder structure for your raw data.","title":"Metabolite data"},{"location":"03-job-files/01-the-job-file/#lineshape-reference-data","text":"OPTIONAL The files_ref variable is defined as a cell array of full paths to the raw MRS data files to your lineshape (water-unsuppressed) reference data. These are an optional input, acquired with the same sequence as the metabolite data, but without water suppression, and used to perform eddy-current correction of the metabolite data. % Specify water reference data for eddy-current correction (same sequence as metabolite data!) % (OPTIONAL) % Leave empty for GE P-files (.7) - these include water reference data by % default. files_ref = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat' )}; If only lineshape reference data are provided, this signal is also used to calculate water-scaled concentration estimates.","title":"Lineshape reference data"},{"location":"03-job-files/01-the-job-file/#short-te-water-data","text":"OPTIONAL The files_w variable is defined as a cell array of full paths to the raw MRS data files to short-TE water data. These are another optional input, and can be used to derive water-scaled concentration estimates (while lineshape reference data are only used for eddy-current correction). Using short-TE water as the concentration reference standard reduces T2-weighting of the water reference signal (and associated correction errors) compared to long-TE water data. % Specify water data for quantification (e.g. short-TE water scan) % (OPTIONAL) files_w = { which ( 'exampledata/sdat/sub-01/mrs/sub-01_press-ref/sub-01_PRESS_35_ref.sdat' ), ... which ( 'exampledata/sdat/sub-02/mrs/sub-02_press-ref/sub-02_PRESS_35_ref.sdat' )};","title":"Short-TE water data"},{"location":"03-job-files/01-the-job-file/#structural-images","text":"OPTIONAL The files_nii variable is defined as a cell array of full paths to T1-weighted structural images used for co-registration and segmentation purposes. Osprey requires NIfTI ( .nii ) files to be supplied. For GE files, you may also provide the full path to a directory containing the DICOM folders corresponding to the T1 acquisition. % Specify T1-weighted structural imaging data % (OPTIONAL) % Link to single NIfTI (.nii) files for Siemens and Philips data % Link to DICOM (.dcm) folders for GE data files_nii = { which ( 'exampledata/sdat/sub-01/anat/sub-01_T1w.nii' ), ... which ( 'exampledata/sdat/sub-02/anat/sub-02_T1w.nii' )}; Osprey uses SPM12 functions to load and process structural images. Please refer to the installation instructions for information on how to set up SPM12.","title":"Structural images"},{"location":"03-job-files/01-the-job-file/#4-specifying-the-output-folder","text":"In this section of the job file, you specify the full paths to an output folder where the Osprey data container is saved in .mat format. In addition, any exported files (for use with jMRUI, TARQUIN, or LCModel) will be saved in separate sub-folders of the output folder. MANDATORY The outputFolder variable specifies a full path to the output folder. If the output folder does not exist yet, it will be created. % Specify output folder % (MANDATORY) outputFolder = strrep ( which ( 'exampledata/sdat/jobSDAT.m' ), 'jobSDAT.m' , 'derivatives' ); In the job files in the example folder of the Osprey repository, the which and strrep functions ensures that an output folder derivatives in the folder where the job file jobSDAT resides. When designing your own job file, you will have to provide the full path to your desired output folder. Note that Osprey detects if the output folder already exists and contains data from a previous analysis. In this case, you will be prompted whether you would like to overwrite the existing output.","title":"4. Specifying the output folder"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/","text":"Osprey GUI tutorial \u00b6 This tutorial describes each step of the Osprey analysis workflow using the graphical user interface. We will learn how to start the GUI, select the job file, load the raw data, process them into spectra, model the processed spectra, co-register the voxel to anatomical images, segment the anatomical images, and derive quantitative metabolite estimates. Info In this documentation chapter, we will use the jobTwix.m job file in the exampledata/twix/ directory of the Osprey repository . 1. Starting Osprey \u00b6 At the MATLAB prompt, enter >> OspreyStartUp This will initiate the Osprey GUI application and the underlying processing modules. Once the startup is complete, you will see the Osprey startup menu box: 2. Loading a job file \u00b6 Click the Load Job file button, navigate to the exampledata/twix directory, and add the file jobTwix.m to the right column: Click Done . If you have run an Osprey analysis previously with the same output folder specified in the job file, you will be shown a warning: Click Yes . Osprey will now extract all necessary information from the job file you selected by running the OspreyJob module in the background. The next window you see is the main GUI: In the bottom left corner, you see a list of datasets included in the job file definition. Info All tabs and buttons (except Load Data , Save MRSCont , and Exit ) are greyed out at this stage. They will become gradually available as we progress through the analysis workflow. 3. Loading the raw MRS data \u00b6 Click the Load data button to initiate the loading process of the raw MRS data. Osprey will now extract the raw FIDs and header data (and perform coil combination, if applicable) by running the OspreyLoad module in the background. For larger files (with separate FIDs for each coil), this process may take a few seconds per dataset. You can monitor the progress through the wait bar. Once the loading process is complete, you can see the coil-combined, but un-aligned and un-averaged data. You can select the dataset you wish to be displayed by clicking on the entry in the dataset list in the bottom left corner: First dataset Second dataset By clicking the metabolites , reference and water tabs at the bottom of the window, you can display the water-suppressed, lineshape reference, and short-TE water data (if applicable): Metabolite data Lineshape reference data Short-TE water data Info In the box above the spectrum display, you will find useful information about the sequence, such as TR/TE, number of averages, voxel dimensions, etc. Info You can export a PDF of the spectrum (along with the information box) by clicking on the Save PDF button in the top right corner of the window. 3. Processing the raw data \u00b6 Click the (now available!) Process data button to initiate the post-processing. Osprey will now perform all appropriate processing steps (depending on the available data: eddy-current correction, frequency-and-phase alignment, water removal, frequency referencing, initial phasing) by running the OspreyProcess module in the background. This process may take several seconds per dataset. You can monitor the progress through the wait bar. Once the post-processing is complete, the Processed tab becomes active, showing four different panels: The top left panel shows the individual averages prior to frequency-and-phase alignment. The bottom left panel shows them after frequency-and-phase alignment. The top right panel shows a scatter plot of the maximum of the 3.02 ppm Cr/PCr signal over the course of the acquisition for both pre- and post-alignment. Finally, the bottom right panel shows the aligned, averaged and referenced spectrum after eddy-current correction and residual water removal. This spectrum will be passed on to the Fit module for modelling. Info You can go back to inspecting the raw data by clicking the Raw tab at the top of the window. Again, you can display each dataset by selecting it from the dataset list in the bottom left corner, and you can look at the water reference data by clicking on the tabs at the bottom of the window. Info In the box above the spectrum display, you will find some data quality metrics, such as the signal-to-noise ratio (SNR), linewidth (FWHM), and average frequency drift pre- and post-alignment. Info You can export a PDF of the four post-processing display panels (along with the information box) by clicking on the Save PDF button in the top right corner of the window. 4. Fitting the spectra \u00b6 Click the (now available!) Fit data button to initiate the post-processing. Osprey will now model the processed metabolite and water spectra by running the OspreyFit module in the background. This process may take from a few seconds up to a minute or more per dataset, depending on the complexity of the model. You can monitor the progress through the wait bar. Once the modelling is complete, the Fit tab becomes active: The Fit tab displays the complete fit overlaid on top of the data, along with the smooth cubic B-spline baseline, and the fit residual at the top. Below, the contributions from each basis functions are plotted, with the estimated lineshape convolution, linebroadening and frequency shift parameters applied. For better display, the phase parameters have been applied to the spectrum, so that the basis functions appear without phase. The left panel shows the raw water-scaled metabolite estimates, i.e. the signal amplitudes normalized by the water amplitude. The amplitude parameters will subsequently be used during the quantification process to derive tCr ratios and water-scaled estimates. Info You can go back to the previous analysis steps by clicking the Raw or Processed tabs at the top of the window. Again, you can display each dataset by selecting it from the dataset list in the bottom left corner, and you can look at the water reference data fits by clicking on the tabs at the bottom of the window. Info In the box above the spectrum display, you will find fit parameters and information, such as the number of basis functions used, phase estimates, and scaling factors. Info You can export a PDF of the fit (along with the information box) by clicking on the Save PDF button in the top right corner of the window. 5. Co-registering to an anatomical image \u00b6 Click the CoRegister button to initiate the SPM routines for co-registering a voxel to a T1-weighted anatomical image. Osprey will now parse the voxel geometry information and create the voxel mask by running the OspreyCoReg module in the background. This process will take a few seconds per dataset. You can monitor the progress through the wait bar. Info If you are only interested in the voxel mask, you can skip the Process and Fit steps of the analysis. The CoRegister button becomes available after the Load data analysis step has been completed. Once the co-registration is complete, the Cor/Seg tab becomes active: You can see an overlay of the voxel mask on top of the anatomical image in three directions. Info You can export a PDF of the co-registration display by clicking on the Save PDF button in the top right corner of the window. 6. Segmentation and tissue fraction calculation \u00b6 Click the Segment button to initiate the determination of the tissue volume fractions for the co-registered voxel. Osprey will now call the SPM12 segmentation functions and calculate the fractions of grey matter, white matter, and cerebrospinal fluid by running the OspreySeg module in the background. If you have previously segmented the images, this step will only take a few seconds. However, if Osprey has to initiate the segmentation first, it can take up to several minutes per dataset. You can monitor the progress through the wait bar. Info If you are only interested in the tissue fractions, you can skip the Process and Fit steps of the analysis. The Segment button becomes available after the Load data and CoRegister analysis steps have been completed. Once the segmentation is complete, the Cor/Seg tab features another figure: Below the overlay produced by CoRegister , you can now see four images showing the voxel mask next to the contributions from grey matter, white matter, and CSF, along with the fractional volume estimates for each tissue class. These values will subsequently be used during quantification to account for tissue-specific effects of relaxation, tissue water content, and metabolite content. Info You can export a PDF of the combined co-registration/segmentation display by clicking on the Save PDF button in the top right corner of the window. 7. Quantification \u00b6 Click the Quantify button to have Osprey run the OspreyQuantify module in the background. This should take less than a second per dataset. During this process, several quantitative metabolite estimates are calculated, such as tCr ratios and water-scaled estimates with different degrees of sophistication. Please refer to the Osprey manuscript for details on the implementation of these quantification routines. Once the quantification is complete, the Quantify tab becomes active: This tab contains a bare-bone table of the quantitative results for each basis function and each quantification routine for the selected dataset. These numbers are saved in .CSV format tables in the QuantifyResults sub-directory of the output folder. At this stage, all analysis steps have been completed. You can save the current state of the analysis by exporting it the Osprey data container as a .mat file using the Save MRSCont button. You can re-load it at any time using the Load MRSCont file button in the Osprey startup menu (see Step 1 of this tutorial). 8. Overview \u00b6 After quantification is complete, another tab becomes active: Overview . This tab contains several visualizations that are interesting for the batched analysis of multiple datasets. By clicking on the tabs at the bottom of the window, you can cycle through the following visualizations: Spectra : Displays all processed spectra (or fits) on top of each other in a single plot. Info You can select the data or complete fits for the metabolite and water data by using the dropdown menu at the top of the window. Mean spectra : Displays the mean of spectra (or fits) across all datasets, along with the mean baseline, mean residual, and a ribbon plot representing the standard deviation across all spectra. Info You can select the metabolite and water data by using the dropdown menu at the top of the window. Mean spectra : Displays the mean of spectra (or fits) across all datasets, along with the mean baseline, mean residual, and a ribbon plot representing the standard deviation across all spectra. Info You can select the metabolite and water data by using the dropdown menu at the top of the window. Quantify table : Shows a table with the results of a specific quantification routine for all metabolites and all datasets. Info You can select the quantification routine to be displayed (tCr ratios, raw water-scaled, CSF-corrected water-scaled, tissue-corrected water-scaled) by using the dropdown menu at the top of the window. Distribution : Shows a raincloud plot of the results of a specific quantification routine for a specific metabolite. The raincloud plot includes a visualization of the distribution, the mean and median values of the distribution, standard deviation, and 25% and 75% percentiles. In addition, each data point is shown. Info You can select the quantification routine to be displayed (tCr ratios, raw water-scaled, CSF-corrected water-scaled, tissue-corrected water-scaled), as well as the particular metabolite you want to study. By default, the Distribution tab is set to display the tCr ratios of tNAA. Correlation : Shows a highly customizable 2D scatter plot of a quantitative metabolite estimate against another quantitative metabolite estimate, or a quality metric. Osprey automatically calculates the Pearson correlation coefficient and a p-value (uncorrected for multiple comparisons), and plots the linear regression line with shaded confidence intervals. Info You can select the quantification routine and metabolite to be correlated, as well as another metabolite or quality metric that it is to be correlated against, by using the dropdown menus at the top of the window. By default, the Correlation tab is set to display the correlation of tNAA/tCr to SNR.","title":"Osprey GUI Tutorial"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#osprey-gui-tutorial","text":"This tutorial describes each step of the Osprey analysis workflow using the graphical user interface. We will learn how to start the GUI, select the job file, load the raw data, process them into spectra, model the processed spectra, co-register the voxel to anatomical images, segment the anatomical images, and derive quantitative metabolite estimates. Info In this documentation chapter, we will use the jobTwix.m job file in the exampledata/twix/ directory of the Osprey repository .","title":"Osprey GUI tutorial"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#1-starting-osprey","text":"At the MATLAB prompt, enter >> OspreyStartUp This will initiate the Osprey GUI application and the underlying processing modules. Once the startup is complete, you will see the Osprey startup menu box:","title":"1. Starting Osprey"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#2-loading-a-job-file","text":"Click the Load Job file button, navigate to the exampledata/twix directory, and add the file jobTwix.m to the right column: Click Done . If you have run an Osprey analysis previously with the same output folder specified in the job file, you will be shown a warning: Click Yes . Osprey will now extract all necessary information from the job file you selected by running the OspreyJob module in the background. The next window you see is the main GUI: In the bottom left corner, you see a list of datasets included in the job file definition. Info All tabs and buttons (except Load Data , Save MRSCont , and Exit ) are greyed out at this stage. They will become gradually available as we progress through the analysis workflow.","title":"2. Loading a job file"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#3-loading-the-raw-mrs-data","text":"Click the Load data button to initiate the loading process of the raw MRS data. Osprey will now extract the raw FIDs and header data (and perform coil combination, if applicable) by running the OspreyLoad module in the background. For larger files (with separate FIDs for each coil), this process may take a few seconds per dataset. You can monitor the progress through the wait bar. Once the loading process is complete, you can see the coil-combined, but un-aligned and un-averaged data. You can select the dataset you wish to be displayed by clicking on the entry in the dataset list in the bottom left corner: First dataset Second dataset By clicking the metabolites , reference and water tabs at the bottom of the window, you can display the water-suppressed, lineshape reference, and short-TE water data (if applicable): Metabolite data Lineshape reference data Short-TE water data Info In the box above the spectrum display, you will find useful information about the sequence, such as TR/TE, number of averages, voxel dimensions, etc. Info You can export a PDF of the spectrum (along with the information box) by clicking on the Save PDF button in the top right corner of the window.","title":"3. Loading the raw MRS data"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#3-processing-the-raw-data","text":"Click the (now available!) Process data button to initiate the post-processing. Osprey will now perform all appropriate processing steps (depending on the available data: eddy-current correction, frequency-and-phase alignment, water removal, frequency referencing, initial phasing) by running the OspreyProcess module in the background. This process may take several seconds per dataset. You can monitor the progress through the wait bar. Once the post-processing is complete, the Processed tab becomes active, showing four different panels: The top left panel shows the individual averages prior to frequency-and-phase alignment. The bottom left panel shows them after frequency-and-phase alignment. The top right panel shows a scatter plot of the maximum of the 3.02 ppm Cr/PCr signal over the course of the acquisition for both pre- and post-alignment. Finally, the bottom right panel shows the aligned, averaged and referenced spectrum after eddy-current correction and residual water removal. This spectrum will be passed on to the Fit module for modelling. Info You can go back to inspecting the raw data by clicking the Raw tab at the top of the window. Again, you can display each dataset by selecting it from the dataset list in the bottom left corner, and you can look at the water reference data by clicking on the tabs at the bottom of the window. Info In the box above the spectrum display, you will find some data quality metrics, such as the signal-to-noise ratio (SNR), linewidth (FWHM), and average frequency drift pre- and post-alignment. Info You can export a PDF of the four post-processing display panels (along with the information box) by clicking on the Save PDF button in the top right corner of the window.","title":"3. Processing the raw data"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#4-fitting-the-spectra","text":"Click the (now available!) Fit data button to initiate the post-processing. Osprey will now model the processed metabolite and water spectra by running the OspreyFit module in the background. This process may take from a few seconds up to a minute or more per dataset, depending on the complexity of the model. You can monitor the progress through the wait bar. Once the modelling is complete, the Fit tab becomes active: The Fit tab displays the complete fit overlaid on top of the data, along with the smooth cubic B-spline baseline, and the fit residual at the top. Below, the contributions from each basis functions are plotted, with the estimated lineshape convolution, linebroadening and frequency shift parameters applied. For better display, the phase parameters have been applied to the spectrum, so that the basis functions appear without phase. The left panel shows the raw water-scaled metabolite estimates, i.e. the signal amplitudes normalized by the water amplitude. The amplitude parameters will subsequently be used during the quantification process to derive tCr ratios and water-scaled estimates. Info You can go back to the previous analysis steps by clicking the Raw or Processed tabs at the top of the window. Again, you can display each dataset by selecting it from the dataset list in the bottom left corner, and you can look at the water reference data fits by clicking on the tabs at the bottom of the window. Info In the box above the spectrum display, you will find fit parameters and information, such as the number of basis functions used, phase estimates, and scaling factors. Info You can export a PDF of the fit (along with the information box) by clicking on the Save PDF button in the top right corner of the window.","title":"4. Fitting the spectra"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#5-co-registering-to-an-anatomical-image","text":"Click the CoRegister button to initiate the SPM routines for co-registering a voxel to a T1-weighted anatomical image. Osprey will now parse the voxel geometry information and create the voxel mask by running the OspreyCoReg module in the background. This process will take a few seconds per dataset. You can monitor the progress through the wait bar. Info If you are only interested in the voxel mask, you can skip the Process and Fit steps of the analysis. The CoRegister button becomes available after the Load data analysis step has been completed. Once the co-registration is complete, the Cor/Seg tab becomes active: You can see an overlay of the voxel mask on top of the anatomical image in three directions. Info You can export a PDF of the co-registration display by clicking on the Save PDF button in the top right corner of the window.","title":"5. Co-registering to an anatomical image"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#6-segmentation-and-tissue-fraction-calculation","text":"Click the Segment button to initiate the determination of the tissue volume fractions for the co-registered voxel. Osprey will now call the SPM12 segmentation functions and calculate the fractions of grey matter, white matter, and cerebrospinal fluid by running the OspreySeg module in the background. If you have previously segmented the images, this step will only take a few seconds. However, if Osprey has to initiate the segmentation first, it can take up to several minutes per dataset. You can monitor the progress through the wait bar. Info If you are only interested in the tissue fractions, you can skip the Process and Fit steps of the analysis. The Segment button becomes available after the Load data and CoRegister analysis steps have been completed. Once the segmentation is complete, the Cor/Seg tab features another figure: Below the overlay produced by CoRegister , you can now see four images showing the voxel mask next to the contributions from grey matter, white matter, and CSF, along with the fractional volume estimates for each tissue class. These values will subsequently be used during quantification to account for tissue-specific effects of relaxation, tissue water content, and metabolite content. Info You can export a PDF of the combined co-registration/segmentation display by clicking on the Save PDF button in the top right corner of the window.","title":"6. Segmentation and tissue fraction calculation"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#7-quantification","text":"Click the Quantify button to have Osprey run the OspreyQuantify module in the background. This should take less than a second per dataset. During this process, several quantitative metabolite estimates are calculated, such as tCr ratios and water-scaled estimates with different degrees of sophistication. Please refer to the Osprey manuscript for details on the implementation of these quantification routines. Once the quantification is complete, the Quantify tab becomes active: This tab contains a bare-bone table of the quantitative results for each basis function and each quantification routine for the selected dataset. These numbers are saved in .CSV format tables in the QuantifyResults sub-directory of the output folder. At this stage, all analysis steps have been completed. You can save the current state of the analysis by exporting it the Osprey data container as a .mat file using the Save MRSCont button. You can re-load it at any time using the Load MRSCont file button in the Osprey startup menu (see Step 1 of this tutorial).","title":"7. Quantification"},{"location":"04-osprey-gui-tutorial/01-osprey-gui-tutorial/#8-overview","text":"After quantification is complete, another tab becomes active: Overview . This tab contains several visualizations that are interesting for the batched analysis of multiple datasets. By clicking on the tabs at the bottom of the window, you can cycle through the following visualizations: Spectra : Displays all processed spectra (or fits) on top of each other in a single plot. Info You can select the data or complete fits for the metabolite and water data by using the dropdown menu at the top of the window. Mean spectra : Displays the mean of spectra (or fits) across all datasets, along with the mean baseline, mean residual, and a ribbon plot representing the standard deviation across all spectra. Info You can select the metabolite and water data by using the dropdown menu at the top of the window. Mean spectra : Displays the mean of spectra (or fits) across all datasets, along with the mean baseline, mean residual, and a ribbon plot representing the standard deviation across all spectra. Info You can select the metabolite and water data by using the dropdown menu at the top of the window. Quantify table : Shows a table with the results of a specific quantification routine for all metabolites and all datasets. Info You can select the quantification routine to be displayed (tCr ratios, raw water-scaled, CSF-corrected water-scaled, tissue-corrected water-scaled) by using the dropdown menu at the top of the window. Distribution : Shows a raincloud plot of the results of a specific quantification routine for a specific metabolite. The raincloud plot includes a visualization of the distribution, the mean and median values of the distribution, standard deviation, and 25% and 75% percentiles. In addition, each data point is shown. Info You can select the quantification routine to be displayed (tCr ratios, raw water-scaled, CSF-corrected water-scaled, tissue-corrected water-scaled), as well as the particular metabolite you want to study. By default, the Distribution tab is set to display the tCr ratios of tNAA. Correlation : Shows a highly customizable 2D scatter plot of a quantitative metabolite estimate against another quantitative metabolite estimate, or a quality metric. Osprey automatically calculates the Pearson correlation coefficient and a p-value (uncorrected for multiple comparisons), and plots the linear regression line with shaded confidence intervals. Info You can select the quantification routine and metabolite to be correlated, as well as another metabolite or quality metric that it is to be correlated against, by using the dropdown menus at the top of the window. By default, the Correlation tab is set to display the correlation of tNAA/tCr to SNR.","title":"8. Overview"}]}